# Recipe Manager - Database Structure

## Current Structure (JSON)

The application now uses an enhanced JSON structure that includes additional metadata for recipes:

```json
{
  "id": 1,
  "title": "Recipe Title",
  "instructions": "Step-by-step instructions",
  "ingredients": "List of ingredients",
  "created_at": "2025-09-07T15:08:55.479Z",
  "updated_at": "2025-09-07T15:08:55.479Z",
  "is_ai_generated": false,
  "source": "manual",
  "tags": ["tag1", "tag2"],
  "difficulty": "easy",
  "prep_time": 15,
  "cook_time": 30,
  "servings": 4
}
```

## Fields Description

- `id`: Unique identifier (auto-generated)
- `title`: Recipe name
- `instructions`: Cooking steps
- `ingredients`: List of ingredients
- `created_at`: Creation timestamp
- `updated_at`: Last modification timestamp
- `is_ai_generated`: Boolean flag indicating if recipe was AI-generated
- `source`: Source of recipe (`manual`, `ai_gemini`, `ai_openai`, `ai_claude`)
- `tags`: Array of tags for categorization
- `difficulty`: Recipe difficulty (`easy`, `medium`, `hard`)
- `prep_time`: Preparation time in minutes
- `cook_time`: Cooking time in minutes
- `servings`: Number of servings

## Migration to MongoDB

### Prerequisites
1. Install MongoDB locally or have access to a MongoDB instance
2. Update your `.env` file with MongoDB connection details

### Configuration

Add these variables to your `.env` file:

```env
# Database Configuration (uncomment when ready to switch)
MONGODB_URI=mongodb://localhost:27017/recipe-manager
MONGODB_DATABASE=recipe_manager
MONGODB_COLLECTION=recipes
STORAGE_TYPE=mongodb
```

### Running the Migration

1. Make sure MongoDB is running
2. Configure the `.env` file as shown above
3. Run the migration script:

```bash
npm run migrate
```

This will:
- Connect to your MongoDB instance
- Create the recipes collection with proper indexes
- Migrate all existing JSON data to MongoDB
- Create a backup of your original JSON file
- Preserve all data including the new metadata fields

### Switching to MongoDB

After successful migration:

1. Update `.env` to set `STORAGE_TYPE=mongodb`
2. Restart your server
3. The application will now use MongoDB instead of JSON files

### Database Schema (MongoDB)

The MongoDB schema includes additional features:
- Full-text search indexes on title, ingredients, and tags
- Indexes for better query performance
- Automatic timestamp management
- Data validation

## API Endpoints

All existing API endpoints remain the same, but now support additional fields:

### POST /recipes
```json
{
  "title": "Recipe Title",
  "instructions": "Instructions",
  "ingredients": "Ingredients",
  "is_ai_generated": true,
  "source": "ai_gemini",
  "tags": ["tag1", "tag2"],
  "difficulty": "medium",
  "prep_time": 15,
  "cook_time": 30,
  "servings": 4
}
```

### Response includes all fields
```json
{
  "id": 1,
  "title": "Recipe Title",
  "instructions": "Instructions",
  "ingredients": "Ingredients",
  "created_at": "2025-09-07T15:08:55.479Z",
  "updated_at": "2025-09-07T15:08:55.479Z",
  "is_ai_generated": true,
  "source": "ai_gemini",
  "tags": ["tag1", "tag2"],
  "difficulty": "medium",
  "prep_time": 15,
  "cook_time": 30,
  "servings": 4
}
```

## Frontend Features

- AI-generated recipes are marked with a ðŸ¤– AI badge
- Recipe details modal shows additional metadata
- Search functionality works across title, ingredients, and tags
- Recipes are automatically tagged when generated by AI

## Environment Variables

```env
# Server Configuration
PORT=3039

# AI API Configuration
API_KEY=your-gemini-api-key-here
MODEL=gemini-2.0-flash

# Database Configuration (for MongoDB)
MONGODB_URI=mongodb://localhost:27017/recipe-manager
MONGODB_DATABASE=recipe_manager
MONGODB_COLLECTION=recipes

# Environment
NODE_ENV=development

# Storage Type (json or mongodb)
STORAGE_TYPE=json
RECIPES_FILE_PATH=./recipes.json
```

## Development

- Current storage: JSON files (easy development)
- Production ready: MongoDB (scalable, searchable)
- Seamless migration between both systems
- All data is preserved during migration
